+++
title = "如何构建"
date = 2025-12-04
description = "这个博客是如何使用zola构建的"
+++

就像构建和使用一个图灵完备机器的重要一步是用这个机器模仿自身一样，这个博客的第一篇文章，我希望其内容就是其构建过程。

### 为什么用zola？
我是个传统的系统级编程语言使用者，对于*高级编程语言*的使用并不熟练，只在很少的时候用一点python(比如跑AI、跑AI以及跑AI)，主要使用c和rust，gemini告诉我既然如此，zola是不错的选择。

### 构建
首先安装zola，安装完毕后运行`zola init myblog`，这将构建一个基本的zola工程，接下来运行`zola serve`，这将启动一个本地服务器，让你能够实时预览

接下来，在[themes][1]中找一个自己喜欢的，一般其存储库中会详述如何使用

### 部署
可以部署在github上，首先新建一个存储库，对于我来说可以起名为`codewenjiu.github.io`，然后将自己的代码上传上去

然后需要跑ci，首先需要设置仓库权限，在`Settings/Actions/General`中，将`Workflow permissions`设置为`Read and write permissions`
接下来新建一个`.github/workflows/deploy.yml`来自动跑ci，内容可以是

{{ code(path=".github/workflows/deploy.yml", type="yml") }}

将更改commit并push，你应当可以看到这次的commit后面多了个黄色圈圈，这说明它正在后台跑ci，等它跑完就会自动deployed这个页面

### WebAssemly
如果只显示一些文本和图片未免有些无趣，通过WebAssembly，我们能够在网页上高效运行几乎任何代码，这里以rust为例

首先新建一个rust项目，加入`wasm-bindgen`依赖，然后可以写例如
{{ code(path="wasm/demo/src/lib.rs", type="rust") }}
这样，`greet`被`start`函数就被暴露出来了，接下来通过wasm-pack编译，将存放结果的pkg文件夹放置在`static`中，就能够被查询到了

但问题是，如何调用呢？这需要写一些html代码，我直接让gemini代劳了
{{ code(path="templates/shortcodes/wasm.html", type="html") }}

然后我们可以通过在markdown中内嵌wasm调用来调用模块中的函数了，比如点击下面的按钮，它会调用 Demo 的 `greet` 函数。
{{ wasm(module="demo", func="greet", args="'Zola user'") }}

又或者，我们可以通过`egui`来在web中跑高速的gui项目
{{ wasm(module="demo", filename="demo", func="start", canvas_id="egui-canvas", width=800, height=500) }}

如果到这一步你发现报错了，那可能说明没过安全性检查，对于我来说，我需要在`config.toml`中添加
```toml
allowed_domains = [
    { directive = "script-src", domains = ["'self'", "'unsafe-inline'", "'unsafe-eval'", "'wasm-unsafe-eval'"] },
    { directive = "connect-src", domains = ["'self'"] },
    { directive = "style-src", domains = ["'self'", "'unsafe-inline'"] },
    { directive = "img-src", domains = ["'self'", "data:", "blob:"] }
]
```
对于你，可能需要查询一下自己使用的theme如何设置了

[1]: https://www.getzola.org/themes/
