<div class="wasm-container" id="wrapper-{{ module }}">
    {% if canvas_id %}
    <canvas
        id="{{ canvas_id }}"
        width="{{ width | default(value=800) }}"
        height="{{ height | default(value=600) }}"
    ></canvas>
    {% else %}
    <div class="wasm-controls">
        <button id="btn-{{ module }}">run: {{ func }}</button>
    </div>
    {% endif %}
    <div class="wasm-status" id="status-{{ module }}"></div>
</div>

<script type="module">
    import init, { {{ func }} } from "/wasm/{{ module }}/{{ module }}.js";

    async function runWasm() {
        const statusEl = document.getElementById("status-{{ module }}");
        statusEl.classList.remove("error");

        try {
            await init();

            {% if canvas_id %}
                {{ func }}("{{ canvas_id }}");
            {% else %}
                document.getElementById("btn-{{ module }}").onclick = () => {
                    {{ func }}({{ args | default(value="") | safe }});
                };
            {% endif %}
        } catch (e) {
            console.error("Wasm Error:", e);
            statusEl.innerText = "err: " + e;
            statusEl.classList.add("error");
        }
    }
    runWasm();
</script>
